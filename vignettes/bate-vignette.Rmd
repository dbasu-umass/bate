---
title: "bate-vignette"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{bate-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(ggplot2)
```

# Bias-Adjusted Treatment Effect

<!-- badges: start -->
<!-- badges: end -->

The goal of the `bate` package is to present some functions to compute quantiles of the empirical distribution of the bias-adjusted treatment effect (BATE) in a linear econometric model with omitted variable bias. To analyze such models, one can consider three regression models: (a) a short regression model where the outcome variable is regressed on the treatment variable, with or without additional controls; (b) an intermediate regression model where additional control variables are added to the short regression; (c) a hypothetical long regression model, where and index of the omitted variable(s) is added to the intermediate regressions. The selection on unobservables is captured by the parameter `delta`; and the R-squared in the hypothetical long regression is captured by the parameter `Rmax`. In addition, we need to consider an auxiliary regression where the treatment variable is regressed on all observed (and included) control variables.

This package provides three functions to compute quantiles of the empirical distribution of the omitted bias and BATE, `ovbias()`, `ovbias_lm()` and `ovbias_par()`. These functions implement the same algorithm to compute the empirical distribution of the bias and BATE and only differ in how the user provides the paramaters of the short, intermediate and auxiliary regressions.

To use the `bset1()` function, the user will need to run the short, intermediate and auxiliary regressions, collect relevant parameters and supply them to `bset`()`. The relevant parameters are:

* beta0: treatment effect in short regression
* R0: R-squared in short regression
* betatilde: treatment effect in intermediate regression
* Rtilde: R-squared in intermediate regression
* taux: variance of residual in auxiliary regression
* sigmay: standard deviation of the outcome variable
* sigmax: standard deviation of the treatment variable.


To use the `bset2()` function, the user will need to run supply a data frame (with all relevant variables), name of the outcome variable, name of the treatment variable, and formulas for the short, intermediate and auxiliary regressions. The function will run the short, intermediate and auxiliary regressions, and collect the relevant parameters internally. 

In both functions, the relevant parameters are used to construct a cubic equation in the omitted variable bias. The cubic equation is solved on a NxN grid over a bounded box of the `(delta,Rmax)` plane, and the roots of the cubic are used to construct the bias-adjusted treatment effect. The bias-adjusted treatment effect is, by definition, the treatment effect estimated from the intermediate regression, `betatilde`, and the real root of the cubic equation.

The bounded box of the `(delta,Rmax)` plane is defined by the Cartesian products of two intervals: `[deltalow, deltahigh]`, and `[Rtilde, Rmax]`. We consider 4 different regimes: (1) low `delta`, low `Rmax`, where `deltalow < delta < 1` and `Rtilde < Rmax < 1.30 Rtilde`; (2) low `delta`, high `Rmax`, where `deltalow < delta < 1` and `Rtilde < Rmax < 2.47 Rtilde`; (3) high `delta`, low `Rmax`, where `1 < delta < deltahigh` and `Rtilde < Rmax < 1.30 Rtilde`; (4) high `delta`, high `Rmax`, where `1 < delta < deltahigh` and `Rtilde < Rmax < 2.47 Rtilde`.

For each regime, the bounded box is divided into two parts: (a) URR region, over which the cubic equation has a unique real root, and (b) NURR region, over which the cubic equation has three real roots. For the NURR region, the root whose distribution is closest to the distribution of the root over the URR region is chosen. If the URR region is empty, unique real roots of the cubic cannot be computed. Hence, the bias-adjusted treatment effect cannot be computed.

The output of the `bset1()` function is a list of two elements. The first element is a data frame of the parameters about the three regressions supplied by the user; the second element of the list is a matrix containing the empirical distribution of the bias-adjusted treatment effect for the four regimes.

The output of the `bset2()` function is a list of two elements. The first element is a data frame of the parameters extracted from the three regressions; the second element of the list is a matrix containing the empirical distribution of the bias-adjusted treatment effect for the four regimes. 

For more details see Basu, D. (2021). "Bounding Sets for Treatment Effects with Proportional Selection". Economics Department Working Paper Series. 307. University of Massachusetts Amhers. URL: https://scholarworks.umass.edu/econ_workingpaper/307. For latest version of the paper use URL: https://drive.google.com/file/d/1v-IGh9_pKqAu7ALucNGTWJXBx0A0STxJ/view?usp=sharing


## Installation

You can install ovbias like so:

``` r
# install.packages("devtools")
devtools::install_github("dbasu-umass/bate")
```
## Example

### Impact of Maternal Behavior on Child IQ

### Impact of Maternal Behavior on Child Birthweight


